# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ2 (2*) "–†–∞–±–æ—Ç–∞ —Å Kubernetes"

## –í—ã–ø–æ–ª–Ω–∏–ª–∏:

–ë–µ–≤–∑ –¢–∏–º–æ—Ñ–µ–π K34201, –ó–∞–≥–∞–π–Ω–æ–≤–∞ –ö—Ä–∏—Å—Ç–∏–Ω–∞ K34201, –ë–ª–æ—Ö–∏–Ω–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è K34201, –ë–∞–ª–∞—à–æ–≤ –ú–∞—Ç–≤–µ–π K34201

## –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã:

–ò–∑—É—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ Kubernetes –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏–µ —Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–µ.

## –ó–∞–¥–∞—á–∏:

- –ü–æ–¥–Ω—è—Ç—å Kubernetes –∫–ª–∞—Å—Ç–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ
- –°–æ–∑–¥–∞—Ç—å Docker-–æ–±—Ä–∞–∑ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ –Ω–∞ Docker Hub
- –ù–∞–ø–∏—Å–∞—Ç—å YAML-—Ñ–∞–π–ª—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞

## –•–æ–¥ —Ä–∞–±–æ—Ç—ã

–î–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è:

- Docker Engine ‚Äì –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–∞ Docker –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- kuberctl ‚Äì –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–º–∞–Ω–¥ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ Kubernetes
- Minikube ‚Äì –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Kubernetes –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞

–ù–∞–ø–∏—à–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∞–π—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ–º —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å. –í–Ω—É—Ç—Ä–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–¥–∏–º —Å–ª–µ–¥—É—é—â–∏–π Dockerfile:

```
FROM nginx:alpine

COPY . /usr/share/nginx/html/

CMD ["nginx", "-g", "daemon off;"]

```

### –†–∞–±–æ—Ç–∞ —Å minikube

–°–æ–∑–¥–∞–¥–∏–º –∫–ª–∞—Å—Ç–µ—Ä minikube

> minikube start
> <br>![](./img/1.jpg)<br/>

–°–æ–∑–¥–∞–¥–∏–º YAML-—Ñ–∞–π–ª, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–ø–∏—à–µ–º Deployment ‚Äì —Ä–µ—Å—É—Ä—Å Kubernetes, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ –∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–º –æ–±—Ä–∞–∑–æ–º. –û–Ω —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–º —Å–ø–æ—Å–æ–±–æ–º —Å–æ–∑–¥–∞–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–æ–≤

```

apiVersion: apps/v1
kind: Deployment
metadata:
  name: weatherapp-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: weatherapp
  template:
    metadata:
      labels:
        app: weatherapp
    spec:
      containers:
      - name: weatherapp
        image: risen73/weather
        ports:
        - containerPort: 8081

```

–í –∫–æ—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –º—ã –∑–∞–¥–∞–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫ (2 —à—Ç—É–∫–∏) –∏ –º–µ—Ç–∫–∏ –¥–ª—è –ø–æ–¥–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —à–∞–±–ª–æ–Ω—É.

–ü—Ä–∏–º–µ–Ω–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

> kubectl apply -f deployment.yaml

–í –Ω–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å 2 –ø–æ–¥–∞:

> kubectl get pods
> <br>![](./img/2.jpg)<br/>

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –ø–æ –µ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É IP-–∞–¥—Ä–µ—Å—É –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes. –ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤–Ω–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ Kubernetes, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –ø–æ–¥ –∫–∞–∫ Service Kubernetes. –°–æ–∑–¥–∞–¥–∏–º YAML-—Ñ–∞–π–ª, –≤ –∫–æ—Ç–æ—Ä–æ–º –µ–≥–æ –æ–ø–∏—à–µ–º

```

apiVersion: v1
kind: Service
metadata:
 name: weatherapp-service
spec:
  selector:
    app: weatherapp
  type: NodePort
  ports:
  - name: http
    port: 80
    targetPort: 80
    nodePort: 30036
    protocol: TCP

```

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–∏–ø —Å–µ—Ä–≤–∏—Å–∞ NodePort, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω –ø—Ä–æ—Å—Ç–æ—Ç –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏, –∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–ª–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ —É –Ω–∞—Å –Ω–µ—Ç

–ü—Ä–∏–º–µ–Ω–∏–º:

> kubectl apply -f service.yaml

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ó–∞–ø—É—Å—Ç–∏–º —Å–µ—Ä–≤–∏—Å –∏ –∏ –±—É–¥–µ–º –Ω–∞–¥–µ—è—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç ü§û

> minikube service weatherapp-service
> <br>![](./img/3.jpg)<br/>

–û—Ç–∫—Ä–æ–µ–º –±—Ä–∞—É–∑–µ—Ä. –£—Ä–∞, –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!
<br>![](./img/4.gif)<br/>

# ‚ú® "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞" ‚ú®

## –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã:

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ HTTPS –≤ k8s-–∫–ª–∞—Å—Ç–µ—Ä–µ, –∏—Å–ø–æ–ª—å–∑—É—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

## –ó–∞–¥–∞—á–∏:

- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- –°–æ–∑–¥–∞—Ç—å —Å–µ–∫—Ä–µ—Ç TLS
- –ù–∞–ø–∏—Å–∞—Ç—å YAML-—Ñ–∞–π–ª –¥–ª—è Ingress
- –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞

## –•–æ–¥ —Ä–∞–±–æ—Ç—ã

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —É—Ç–∏–ª–∏—Ç–æ–π openssl:

> openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/CN=weatherapp.ru"
> <br>![](./img/5.png)<br/>

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ä–∞–±–æ—Ç—ã —É—Ç–∏–ª–∏—Ç—ã –≤ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –¥–≤–∞ —Ñ–∞–π–ª–∞: tls.key –∏
tls.crt (–∫–ª—é—á –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ).

–°–æ–∑–¥–∞–¥–∏–º TLS-—Å–µ–∫—Ä–µ—Ç, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∏ –∫–ª—é—á–∞ —É–∫–∞–∂–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ —Ñ–∞–π–ª—ã:

> kubectl create secret tls weatherapp-tls --key="tls.key" --cert-"tls.crt"
> <br>![](./img/6.png)<br/>

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Ingress

Ingress ‚Äì —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:

> minikube addons enable ingress
> <br>![](./img/7.png)<br/>

–û–±—Ä–∞—Ç–∏–º –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–æ—á–∫—É –ø—Ä–æ minikube tunnel (–º—ã –≤–æ—Ç –æ–±—Ä–∞—Ç–∏–ª–∏ –Ω–µ —Å—Ä–∞–∑—É)

–°–æ–∑–¥–∞–¥–∏–º YAML-—Ñ–∞–π–ª

```

apiVersion: networking.k8s.io/v1
kind: Ingress

metadata:
  name: weatherapp-ingress
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"

spec:
  tls:
    - hosts:
      - weatherapp.ru
      secretName: weatherapp-tls

  rules:
  - host: weatherapp.ru
    http:
      paths:
      - path: "/"
        pathType: Prefix
        backend:
          service:
            name: weatherapp-service
            port:
              number: 80

```

–í –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ –º—ã —É–∫–∞–∑–∞–ª–∏, —á—Ç–æ –≤—Å–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ HTTPS, –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –æ–¥–∏–Ω —Ö–æ—Å—Ç - weatherapp.ru –∏ —Å–µ–∫—Ä–µ—Ç - weatherapp-tls, –¥–ª—è —Ö–æ—Å—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –ø—Ä–∞–≤–∏–ª–∞: –≤—Å–µ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å /, –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–∏—Å weatherapp-service —Å –ø–æ—Ä—Ç–æ–º 80.

–ü—Ä–∏–º–µ–Ω–∏–º:

> kubectl apply -f ingress.yaml

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–í—Å–ø–æ–º–∏–Ω–∞–µ–º –ø—Ä–æ –∫–æ–º–∞–Ω–¥—É minikube tunnel - –µ–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–∞—à–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ Ingress –ø–æ –∞–¥—Ä–µ—Å—É 127.0.0.1. –ó–∞–ø—É—Å—Ç–∏–º –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

> minikube tunnel

–¢–∞–∫–∂–µ –ø—Ä–æ–ø–∏—à–µ–º –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è weatherapp –∏ –µ–≥–æ ip-–∞–¥—Ä–µ—Å (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ 127.0.0.1) –≤ —Ñ–∞–π–ª–µ hosts.

–ú–æ–∂–µ–º –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –≤–∫–ª–∞–¥–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
<br>![](./img/8.jpg)<br/>

–ù–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫ –≤—Å–µ-—Ç–∞–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å
<br>![](./img/9.jpg)<br/>
<br>![](./img/10.jpg)<br/>
–ê –ø–æ—á–µ–º—É –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–π?
–ö–∞–∫ –º—ã –≤—ã—è—Å–Ω–∏–ª–∏, —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–µ —Ç–∞–∫ —É–∂ –∏ —Å–ª–æ–∂–Ω–æ, –Ω–∞–≤–µ—Ä–Ω–æ–µ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∏ —Ç–æ–∂–µ –º–æ–≥—É—Ç —Ç–∞–∫–æ–º—É –Ω–∞—É—á–∏—Ç—å—Å—è. –í–æ—Ç –±—Ä–∞—É–∑–µ—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –∏ –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –∑–∞–≤–µ—Ä–∏–ª –µ–≥–æ –Ω–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ü–µ–Ω—Ç—Ä.

## –í—ã–≤–æ–¥:

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±—ã–ª–∏ –∏–∑—É—á–µ–Ω—ã —Ä–µ—Å—É—Ä—Å—ã Kubernetes –∏ –ø–æ–ª—É—á–µ–Ω—ã –Ω–∞–≤—ã–∫–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–µ.
